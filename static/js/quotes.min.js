function _regeneratorRuntime() { "use strict"; _regeneratorRuntime = function () { return c }; var u, c = {}, e = Object.prototype, s = e.hasOwnProperty, l = Object.defineProperty || function (e, t, r) { e[t] = r.value }, t = "function" == typeof Symbol ? Symbol : {}, n = t.iterator || "@@iterator", r = t.asyncIterator || "@@asyncIterator", a = t.toStringTag || "@@toStringTag"; function o(e, t, r) { return Object.defineProperty(e, t, { value: r, enumerable: !0, configurable: !0, writable: !0 }), e[t] } try { o({}, "") } catch (u) { o = function (e, t, r) { return e[t] = r } } function i(e, t, r, n) { var a, o, c, i, t = t && t.prototype instanceof v ? t : v, t = Object.create(t.prototype), n = new T(n || []); return l(t, "_invoke", { value: (a = e, o = r, c = n, i = p, function (e, t) { if (i === h) throw new Error("Generator is already running"); if (i === m) { if ("throw" === e) throw t; return { value: u, done: !0 } } for (c.method = e, c.arg = t; ;) { var r = c.delegate; if (r) { r = function e(t, r) { var n = r.method, a = t.iterator[n]; if (a === u) return r.delegate = null, "throw" === n && t.iterator.return && (r.method = "return", r.arg = u, e(t, r), "throw" === r.method) || "return" !== n && (r.method = "throw", r.arg = new TypeError("The iterator does not provide a '" + n + "' method")), g; n = d(a, t.iterator, r.arg); if ("throw" === n.type) return r.method = "throw", r.arg = n.arg, r.delegate = null, g; a = n.arg; return a ? a.done ? (r[t.resultName] = a.value, r.next = t.nextLoc, "return" !== r.method && (r.method = "next", r.arg = u), r.delegate = null, g) : a : (r.method = "throw", r.arg = new TypeError("iterator result is not an object"), r.delegate = null, g) }(r, c); if (r) { if (r === g) continue; return r } } if ("next" === c.method) c.sent = c._sent = c.arg; else if ("throw" === c.method) { if (i === p) throw i = m, c.arg; c.dispatchException(c.arg) } else "return" === c.method && c.abrupt("return", c.arg); i = h; r = d(a, o, c); if ("normal" === r.type) { if (i = c.done ? m : f, r.arg === g) continue; return { value: r.arg, done: c.done } } "throw" === r.type && (i = m, c.method = "throw", c.arg = r.arg) } }) }), t } function d(e, t, r) { try { return { type: "normal", arg: e.call(t, r) } } catch (e) { return { type: "throw", arg: e } } } c.wrap = i; var p = "suspendedStart", f = "suspendedYield", h = "executing", m = "completed", g = {}; function v() { } function y() { } function b() { } var t = {}, x = (o(t, n, function () { return this }), Object.getPrototypeOf), x = x && x(x(S([]))), k = (x && x !== e && s.call(x, n) && (t = x), b.prototype = v.prototype = Object.create(t)); function q(e) { ["next", "throw", "return"].forEach(function (t) { o(e, t, function (e) { return this._invoke(t, e) }) }) } function w(c, i) { var t; l(this, "_invoke", { value: function (r, n) { function e() { return new i(function (e, t) { !function t(e, r, n, a) { var o, e = d(c[e], c, r); if ("throw" !== e.type) return (r = (o = e.arg).value) && "object" == typeof r && s.call(r, "__await") ? i.resolve(r.__await).then(function (e) { t("next", e, n, a) }, function (e) { t("throw", e, n, a) }) : i.resolve(r).then(function (e) { o.value = e, n(o) }, function (e) { return t("throw", e, n, a) }); a(e.arg) }(r, n, e, t) }) } return t = t ? t.then(e, e) : e() } }) } function E(e) { var t = { tryLoc: e[0] }; 1 in e && (t.catchLoc = e[1]), 2 in e && (t.finallyLoc = e[2], t.afterLoc = e[3]), this.tryEntries.push(t) } function Q(e) { var t = e.completion || {}; t.type = "normal", delete t.arg, e.completion = t } function T(e) { this.tryEntries = [{ tryLoc: "root" }], e.forEach(E, this), this.reset(!0) } function S(t) { if (t || "" === t) { var r, e = t[n]; if (e) return e.call(t); if ("function" == typeof t.next) return t; if (!isNaN(t.length)) return r = -1, (e = function e() { for (; ++r < t.length;)if (s.call(t, r)) return e.value = t[r], e.done = !1, e; return e.value = u, e.done = !0, e }).next = e } throw new TypeError(typeof t + " is not iterable") } return l(k, "constructor", { value: y.prototype = b, configurable: !0 }), l(b, "constructor", { value: y, configurable: !0 }), y.displayName = o(b, a, "GeneratorFunction"), c.isGeneratorFunction = function (e) { e = "function" == typeof e && e.constructor; return !!e && (e === y || "GeneratorFunction" === (e.displayName || e.name)) }, c.mark = function (e) { return Object.setPrototypeOf ? Object.setPrototypeOf(e, b) : (e.__proto__ = b, o(e, a, "GeneratorFunction")), e.prototype = Object.create(k), e }, c.awrap = function (e) { return { __await: e } }, q(w.prototype), o(w.prototype, r, function () { return this }), c.AsyncIterator = w, c.async = function (e, t, r, n, a) { void 0 === a && (a = Promise); var o = new w(i(e, t, r, n), a); return c.isGeneratorFunction(t) ? o : o.next().then(function (e) { return e.done ? e.value : o.next() }) }, q(k), o(k, a, "Generator"), o(k, n, function () { return this }), o(k, "toString", function () { return "[object Generator]" }), c.keys = function (e) { var t, r = Object(e), n = []; for (t in r) n.push(t); return n.reverse(), function e() { for (; n.length;) { var t = n.pop(); if (t in r) return e.value = t, e.done = !1, e } return e.done = !0, e } }, c.values = S, T.prototype = { constructor: T, reset: function (e) { if (this.prev = 0, this.next = 0, this.sent = this._sent = u, this.done = !1, this.delegate = null, this.method = "next", this.arg = u, this.tryEntries.forEach(Q), !e) for (var t in this) "t" === t.charAt(0) && s.call(this, t) && !isNaN(+t.slice(1)) && (this[t] = u) }, stop: function () { this.done = !0; var e = this.tryEntries[0].completion; if ("throw" === e.type) throw e.arg; return this.rval }, dispatchException: function (r) { if (this.done) throw r; var n = this; function e(e, t) { return o.type = "throw", o.arg = r, n.next = e, t && (n.method = "next", n.arg = u), !!t } for (var t = this.tryEntries.length - 1; 0 <= t; --t) { var a = this.tryEntries[t], o = a.completion; if ("root" === a.tryLoc) return e("end"); if (a.tryLoc <= this.prev) { var c = s.call(a, "catchLoc"), i = s.call(a, "finallyLoc"); if (c && i) { if (this.prev < a.catchLoc) return e(a.catchLoc, !0); if (this.prev < a.finallyLoc) return e(a.finallyLoc) } else if (c) { if (this.prev < a.catchLoc) return e(a.catchLoc, !0) } else { if (!i) throw new Error("try statement without catch or finally"); if (this.prev < a.finallyLoc) return e(a.finallyLoc) } } } }, abrupt: function (e, t) { for (var r = this.tryEntries.length - 1; 0 <= r; --r) { var n = this.tryEntries[r]; if (n.tryLoc <= this.prev && s.call(n, "finallyLoc") && this.prev < n.finallyLoc) { var a = n; break } } var o = (a = a && ("break" === e || "continue" === e) && a.tryLoc <= t && t <= a.finallyLoc ? null : a) ? a.completion : {}; return o.type = e, o.arg = t, a ? (this.method = "next", this.next = a.finallyLoc, g) : this.complete(o) }, complete: function (e, t) { if ("throw" === e.type) throw e.arg; return "break" === e.type || "continue" === e.type ? this.next = e.arg : "return" === e.type ? (this.rval = this.arg = e.arg, this.method = "return", this.next = "end") : "normal" === e.type && t && (this.next = t), g }, finish: function (e) { for (var t = this.tryEntries.length - 1; 0 <= t; --t) { var r = this.tryEntries[t]; if (r.finallyLoc === e) return this.complete(r.completion, r.afterLoc), Q(r), g } }, catch: function (e) { for (var t = this.tryEntries.length - 1; 0 <= t; --t) { var r, n, a = this.tryEntries[t]; if (a.tryLoc === e) return "throw" === (r = a.completion).type && (n = r.arg, Q(a)), n } throw new Error("illegal catch attempt") }, delegateYield: function (e, t, r) { return this.delegate = { iterator: S(e), resultName: t, nextLoc: r }, "next" === this.method && (this.arg = u), g } }, c } function asyncGeneratorStep(e, t, r, n, a, o, c) { try { var i = e[o](c), u = i.value } catch (e) { return void r(e) } i.done ? t(u) : Promise.resolve(u).then(n, a) } function _asyncToGenerator(i) { return function () { var e = this, c = arguments; return new Promise(function (t, r) { var n = i.apply(e, c); function a(e) { asyncGeneratorStep(n, t, r, a, o, "next", e) } function o(e) { asyncGeneratorStep(n, t, r, a, o, "throw", e) } a(void 0) }) } } var baseUrl = window.location.origin, csrftoken = document.querySelector("[name=csrfmiddlewaretoken]").value, programId = document.querySelector("[name=quote-section]").getAttribute("data-program-id"), activeQuotes = document.querySelectorAll(".active-quotes"), activeQuotesIds = Array.from(activeQuotes).map(function (e) { return e.getAttribute("data-quote-id") }), relatedQuotesWrapper = document.querySelector("#related-quotes-wrapper"), titleInputs = document.querySelectorAll(".updatedModalTitle"), createQuoteModalTitle = document.querySelector("#createQuoteTitle"), expectedGraduationFeild = document.querySelector("#graduationYear"), createQuoteHelperObj = { createFirstNameQuote: "", createLastNameQuote: "", graduationYear: "" }, modal = (titleInputs.forEach(function (e) { e.addEventListener("change", function (e) { if (e.target.classList.contains("form-check-input")) switch (e.target.value) { case "student": expectedGraduationFeild.removeAttribute("disabled"), $(".yearpicker").yearpicker({ selectedClass: "selected text-black bg-primary", template: '<div class="yearpicker-container">\n              <div class="yearpicker-header">\n                  <div class="yearpicker-prev" data-view="yearpicker-prev">&lsaquo;</div>\n                  <div class="yearpicker-current" data-view="yearpicker-current">SelectedYear</div>\n                  <div class="yearpicker-next" data-view="yearpicker-next">&rsaquo;</div>\n              </div>\n              <div class="yearpicker-body">\n                  <ul class="yearpicker-year" data-view="years">\n                  </ul>\n              </div>\n          </div>\n          ' }), $(".yearpicker").on("change", function () { createQuoteHelperObj.graduationYear = $(this).val().slice(-2), graduationYear ? createQuoteModalTitle.value = createQuoteHelperObj.graduationYear + "'" : createQuoteModalTitle.value = "" }); break; case "other": createQuoteHelperObj.graduationYear = "", expectedGraduationFeild.setAttribute("disabled", ""), createQuoteModalTitle.value = "" }createQuoteHelperObj[e.target.id] = e.target.value }) }), $(".yearpicker").on("change", function () { createQuoteHelperObj.graduationYear = $(this).val().slice(-2), graduationYear ? createQuoteModalTitle.value = createQuoteHelperObj.graduationYear + "'" : createQuoteModalTitle.value = "" }), document.getElementById("activeQuoteModal")), editModalSaveBtn = modal.querySelector("#editModalSaveBtn"), AllQuotes = [], fetchQuotes = function () { var e = _asyncToGenerator(_regeneratorRuntime().mark(function e() { var t; return _regeneratorRuntime().wrap(function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.prev = 0, e.next = 3, fetch(baseUrl + "/api/v1/marketing/quotes/"); case 3: if ((t = e.sent).ok) return e.next = 7, t.json(); e.next = 11; break; case 7: (t = e.sent) && AllQuotes.push.apply(AllQuotes, t.results), e.next = 12; break; case 11: console.error("Failed to fetch quotes"); case 12: e.next = 17; break; case 14: e.prev = 14, e.t0 = e.catch(0), console.error("Error fetching quotes:", e.t0); case 17: case "end": return e.stop() } }, e, null, [[0, 14]]) })); return function () { return e.apply(this, arguments) } }(), renderRelatedQuotes = function () { AllQuotes.forEach(function (e) { activeQuotesIds.includes(e.id.toString()) || (e = '\n        <div class="col-md-4 mb-3">\n          <div class="card h-100">\n            <div class="card-header text-center">\n              ' + (e.image ? '<img src="' + e.image + '" class="card-img-top rounded-circle w-50" alt="...">' : "") + '\n            </div>\n            <div class="card-body">\n              <p class="card-text">' + e.quote_text + '</p>\n              <p class="card-text"><strong>' + e.source + "</strong> " + e.titles + '</p>\n            </div>\n            <div class="card-footer text-center">\n              <button class="btn" data-quote-id="' + e.id + '" id="addQuoteBtn" onClick="attachQuoteToProgram(' + e.id + ')"><span class="fa-xl fa-regular fa-square-plus me-2"></span>Attach Quote</button>\n            </div>\n          </div>\n        </div>\n      ', relatedQuotesWrapper.innerHTML += e) }) }; function handleImageUpload(e) { var t, e = e.target.files[0]; e && ((t = new FileReader).onload = function (e) { e = e.target.result; sessionStorage.setItem("uploadedImage", e), document.getElementById("createSelectedAvatar").src = e }, t.readAsDataURL(e)) } function createQuote(e) { return _createQuote.apply(this, arguments) } function _createQuote() { return (_createQuote = _asyncToGenerator(_regeneratorRuntime().mark(function e(t) { var r, n, a, o, c, i, u, s, l; return _regeneratorRuntime().wrap(function (e) { for (; ;)switch (e.prev = e.next) { case 0: if (t.preventDefault(), r = document.getElementById("createFirstNameQuote").value.trim(), n = document.getElementById("createLastNameQuote").value.trim(), a = document.getElementById("createQuoteText").value.trim(), o = document.getElementById("createQuoteTitle").value.trim(), c = document.querySelector('input[name="createTags"]').value.split(","), i = document.getElementById("createCustomFile").files[0], r) { e.next = 11; break } return alert("First Name is required!"), document.getElementById("createFirstNameQuote").focus(), e.abrupt("return"); case 11: if (n) { e.next = 15; break } return alert("Last Name is required!"), document.getElementById("createLastNameQuote").focus(), e.abrupt("return"); case 15: if (o) { e.next = 19; break } return alert("Title is required!"), document.getElementById("createQuoteTitle").focus(), e.abrupt("return"); case 19: if (a) { e.next = 23; break } return alert("Quote text is required!"), document.getElementById("createQuoteText").focus(), e.abrupt("return"); case 23: if (c.length) { e.next = 27; break } return alert("Tag is required!"), document.getElementById("createQuoteTitle").focus(), e.abrupt("return"); case 27: if (e.prev = 27, i) return (s = new FormData).append("quote_text", a), s.append("source", r + " " + n), s.append("titles", o), c.forEach(function (e) { return s.append("tags", e.trim()) }), s.append("image", i), e.next = 37, fetch(baseUrl + "/api/v1/marketing/quotes/create/", { method: "POST", headers: { "X-CSRFToken": csrftoken }, body: s }); e.next = 40; break; case 37: u = e.sent, e.next = 44; break; case 40: return l = { quote_text: a, source: r + " " + n, titles: o, tags: c.map(function (e) { return e.trim() }) }, e.next = 43, fetch(baseUrl + "/api/v1/marketing/quotes/create/", { method: "POST", headers: { "Content-Type": "application/json", "X-CSRFToken": csrftoken }, body: JSON.stringify(l) }); case 43: u = e.sent; case 44: if (u.ok) { e.next = 46; break } throw new Error("Failed to create quote."); case 46: return e.next = 48, u.json(); case 48: l = e.sent, console.log("Quote Created:", l), attachQuoteToProgram(l.id), e.next = 57; break; case 53: e.prev = 53, e.t0 = e.catch(27), console.error("Error:", e.t0), alert("Failed to create quote. Please try again."); case 57: case "end": return e.stop() } }, e, null, [[27, 53]]) }))).apply(this, arguments) } function attachQuoteToProgram(e) { return _attachQuoteToProgram.apply(this, arguments) } function _attachQuoteToProgram() { return (_attachQuoteToProgram = _asyncToGenerator(_regeneratorRuntime().mark(function e(t) { var r, n, a; return _regeneratorRuntime().wrap(function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.prev = 0, e.next = 3, fetch("/api/v1/programs/" + programId + "/"); case 3: if ((r = e.sent).ok) { e.next = 6; break } throw new Error("Failed to fetch program data"); case 6: return e.next = 8, r.json(); case 8: return n = e.sent, console.log(n), (n = n.quotes || []).push(t), e.next = 14, fetch("/api/v1/programs/" + programId + "/", { method: "PATCH", headers: { "Content-Type": "application/json", "X-CSRFToken": csrftoken }, body: JSON.stringify({ quotes: n }) }); case 14: if ((n = e.sent).ok) { e.next = 20; break } return e.next = 18, n.json(); case 18: throw a = e.sent, new Error("Failed to attach quote: " + JSON.stringify(a)); case 20: console.log("Quote successfully attached!"), location.reload(), e.next = 28; break; case 24: e.prev = 24, e.t0 = e.catch(0), console.error("Error:", e.t0), alert("Failed to attach quote to program."); case 28: case "end": return e.stop() } }, e, null, [[0, 24]]) }))).apply(this, arguments) } fetchQuotes().then(renderRelatedQuotes), activeQuotes.forEach(function (s) { var e = s.querySelector(".active-quote-edit"), t = s.querySelector(".active-quote-detach"), l = s.getAttribute("data-quote-id"); e.addEventListener("click", function () { var e = s.querySelector(".active-quotes-quoteSource").innerText, t = s.querySelector(".active-quotes-quoteText").innerHTML, r = s.querySelector(".active-quotes-quoteTitle").innerHTML; document.getElementById("quoteText").value = t, document.getElementById("quoteSource").value = e, document.getElementById("quoteTitle").value = r, $(modal).modal("show"), editModalSaveBtn.onclick = _asyncToGenerator(_regeneratorRuntime().mark(function e() { var t, r, n, a, o, c, i, u; return _regeneratorRuntime().wrap(function (e) { for (; ;)switch (e.prev = e.next) { case 0: if (t = document.getElementById("quoteText").value, r = document.getElementById("quoteSource").value, n = document.getElementById("quoteTitle").value, a = document.getElementById("quoteImage").files[0], r) { e.next = 8; break } return alert("Source is required!"), document.getElementById("createFirstNameQuote").focus(), e.abrupt("return"); case 8: if (n) { e.next = 12; break } return alert("Title is required!"), document.getElementById("createQuoteTitle").focus(), e.abrupt("return"); case 12: if (t) { e.next = 16; break } return alert("Quote text is required!"), document.getElementById("createQuoteText").focus(), e.abrupt("return"); case 16: if (a) { e.next = 39; break } return o = { quote_text: t, source: r, titles: n, tags: ["test"] }, e.prev = 18, e.next = 21, fetch(baseUrl + "/api/v1/marketing/quotes/" + l + "/", { method: "PUT", headers: { "Content-Type": "application/json", "X-CSRFToken": csrftoken }, body: JSON.stringify(o) }); case 21: if ((o = e.sent).ok) return e.next = 25, o.json(); e.next = 31; break; case 25: c = e.sent, console.log("Quote updated successfully:", c), $(modal).modal("hide"), location.reload(), e.next = 32; break; case 31: console.error("Failed to update quote"); case 32: e.next = 37; break; case 34: e.prev = 34, e.t0 = e.catch(18), console.error("Error updating quote:", e.t0); case 37: e.next = 68; break; case 39: if (a) return (c = new FormData).append("quote_text", t), c.append("source", r), c.append("titles", n), c.append("tags", "test"), c.append("image", a), e.prev = 46, e.next = 49, fetch(baseUrl + "/api/v1/marketing/quotes/" + l + "/", { method: "PATCH", headers: { "X-CSRFToken": csrftoken }, body: c }); e.next = 68; break; case 49: if ((i = e.sent).ok) return e.next = 53, i.json(); e.next = 62; break; case 53: i = e.sent, (u = s.querySelector(".active-quotes-quoteImage")) || (u = document.createElement("img")).classList.add("active-quotes-quoteImage"), u.src = "" + i.image, document.getElementById("quoteImage").value = "", $(modal).modal("hide"), location.reload(), e.next = 63; break; case 62: console.error("Failed to update quote"); case 63: e.next = 68; break; case 65: e.prev = 65, e.t1 = e.catch(46), console.error("Error updating quote:", e.t1); case 68: case "end": return e.stop() } }, e, null, [[18, 34], [46, 65]]) })) }), t.addEventListener("click", _asyncToGenerator(_regeneratorRuntime().mark(function e() { return _regeneratorRuntime().wrap(function (e) { for (; ;)switch (e.prev = e.next) { case 0: return e.prev = 0, e.next = 3, fetch(baseUrl + "/api/v1/programs/" + programId + "/", { method: "PATCH", headers: { "Content-Type": "application/json", "X-CSRFToken": csrftoken }, body: JSON.stringify({ quotes: activeQuotesIds.filter(function (e) { return e !== l }) }) }); case 3: e.sent.ok ? (console.log("Quote detached successfully"), location.reload()) : console.error("Failed to detach quote", error), e.next = 10; break; case 7: e.prev = 7, e.t0 = e.catch(0), console.error("Error detaching quote:", e.t0); case 10: case "end": return e.stop() } }, e, null, [[0, 7]]) }))) }), modal.querySelector(".btn-close").addEventListener("click", function () { $("#activeQuoteModal").modal("hide") });